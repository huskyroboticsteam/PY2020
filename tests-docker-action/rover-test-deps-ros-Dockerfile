FROM ubuntu:20.04

ARG DEBIAN_FRONTEND=noninteractive

WORKDIR "/"

# Run system software update
RUN apt-get update
RUN apt-get upgrade -y

# Install system dependencies
RUN apt-get install -y wget unzip curl gnupg2 lsb-release git cmake g++ make

################### SFML ###################

RUN apt-get install -y libsfml-dev

################### EIGEN ###################

RUN apt-get install -y libeigen3-dev

################### OPENCV ###################

# Install OpenCV
RUN apt-get install -y libopencv-dev libopencv-contrib-dev

################### CATCH2 ###################
WORKDIR "/tmp"

# Download Catch2
RUN git clone https://github.com/catchorg/catch2

# Configure Catch2
WORKDIR "/tmp/catch2"
# Check out the correct release tag
RUN git checkout v2.13.4
# Make build directory
RUN mkdir build
WORKDIR "/tmp/catch2/build"
# Run CMake config
RUN cmake ..

# Build Catch2
RUN make

# Install Catch2
RUN make install

# Clean up sources to save storage space
WORKDIR "/tmp"
RUN rm -rf catch2

WORKDIR "/"

################### LIDAR ###################

WORKDIR "/tmp/"

# Download the URG Lidar library
RUN git clone https://github.com/andrewbriand/urg_library-1.2.5.git
WORKDIR "/tmp/urg_library-1.2.5"

# Build URG library
RUN make

# Install URG library
RUN make install

# Clean up sources to save storage space
WORKDIR "/tmp"
RUN rm -rf urg_library-1.2.5

WORKDIR "/"

################### ROS2 ###################

# Update locale
RUN apt-get install -y locales
RUN locale-gen en_US en_US.UTF-8 && update-locale LC_ALL=en_US.UTF-8 LANG=en_US.UTF-8
ENV LANG=en_US.UTF-8

# Add ROS GPG keys
RUN curl -s https://raw.githubusercontent.com/ros/rosdistro/master/ros.asc | apt-key add -
RUN sh -c 'echo "deb [arch=$(dpkg --print-architecture)] http://packages.ros.org/ros2/ubuntu $(lsb_release -cs) main" > /etc/apt/sources.list.d/ros2-latest.list'

# Install ROS
RUN apt-get update && apt-get install -y ros-foxy-ros-base
