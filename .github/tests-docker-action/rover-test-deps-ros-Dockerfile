# -*- mode: dockerfile -*-
FROM ubuntu:20.04

ARG DEBIAN_FRONTEND=noninteractive

# Run system software update
RUN apt-get update && apt-get upgrade -y

# Install system dependencies
RUN apt-get install -y build-essential wget unzip curl gnupg2 lsb-release git cmake

# Install project dependencies; this includes SFML, Eigen, OpenCV, WebSocket++, and Boost
# System.

RUN apt-get install -y libsfml-dev libeigen3-dev libopencv-dev libopencv-contrib-dev \
	libwebsocketpp-dev libboost-system-dev

# Install project dependencies that need to be built from source.
################### CATCH2 ###################

# Download Catch2
RUN git clone https://github.com/catchorg/catch2 /tmp/catch2

# Configure Catch2
WORKDIR "/tmp/catch2"
# Check out the correct release tag
RUN git checkout v2.13.4
# Make build directory
RUN mkdir build
WORKDIR "/tmp/catch2/build"
# Run CMake config; build and install
RUN cmake .. -DBUILD_TESTING=OFF && cmake --build . --target install

################### LIDAR ###################

# Download the URG Lidar library
RUN git clone https://github.com/huskyroboticsteam/urg-lidar.git /tmp/urg-lidar
WORKDIR "/tmp/urg-lidar"

# Build URG library
RUN mkdir -p build
WORKDIR "/tmp/urg-lidar/build"
RUN cmake .. && cmake --build . --target install

#############################################
# Clean up sources to save space
RUN rm -rf /tmp/urg-lidar /tmp/catch2

WORKDIR "/"
